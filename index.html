<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
  <link rel="icon" href="assets/images/favicon.svg">
  <title>2 ROOMS 1 BOOM</title>

  <link rel="stylesheet" type="text/css" href="assets/styles/index.css">
</head>


<body>
<section class="page">
  <h1 class="header-text">2 ROOMS<br>1 BOOM</h1>


  <main class="main-text">
    <h1>2 комнаты, 1 бомба</h1>

    <section>
      <section class="download-sw-site" id="button-download">
        <div id="button-download-text-info">
          <img src="assets/images/download.svg" alt="download">Сохранить весь сайт на устройстве
          <br>
          <small><i>(Для доступа без интернета)</i></small>
        </div>
        <small><samp id="button-download-current-info"><!-- Text from JS --></samp></small>
        <br>
        <small><samp id="button-download-progress-info"><!-- Text from JS --></samp></small>
      </section>
      <p>Все игроки разделены на две команды и случайно перемешаны между двумя комнатами. Сможете ли вы привести свою команду к победе?</p>
    </section>

    <hr>

    <section>
      <h3>Цели</h3>
      <p class="blue"><img src="assets/images/shield_person.svg" alt="">В <mark>Синей команде</mark> есть 1 <mark>Президент</mark></p>
      <p class="red"><img src="assets/images/bomb.svg" alt="">В <mark>Красной команде</mark> есть 1 <mark>Бомбер</mark></p>
      <p>
        В конце игры вся комната с <mark class="red">Бомбером</mark> взрывается.
        Если <mark class="blue">Президент</mark> и <mark class="red">Бомбер</mark> находились в одной комнате, выирывает <mark class="red">Красная команда</mark>. Если в разных комнатах - <mark class="blue">Синяя команда</mark>
      </p>
      <p class="grey"><img src="assets/images/person_effect.svg" alt=""><mark>Серые персонажи</mark> имеют свои личные цели для победы</p>
    </section>

    <hr>

    <section>
      <h3>Раунды</h3>
      <p>
        5 раундов с ограниченной длительностью. После каждого раунда из каждой комнаты передают заданное число людей в другую комнату.
      </p>
      <p class="info">
        Во время раунда в каждой комнате общим голосованием должен быть выбран <mark>Лидер</mark>.
        Именно <mark>Лидер</mark> лично выбирает людей, которые отправятся в другую комнату.
      </p>
      <table>
        <tr>
          <th>Раунд</th>
          <th>Время раунда</th>
          <th>Людей меняется</th>
        </tr>
        <tr>
          <td>1</td>
          <td>5 мин</td>
          <td>5 человек</td>
        </tr>
        <tr>
          <td>2</td>
          <td>4 мин</td>
          <td>4 человек</td>
        </tr>
        <tr>
          <td>3</td>
          <td>3 мин</td>
          <td>3 человек</td>
        </tr>
        <tr>
          <td>4</td>
          <td>2 мин</td>
          <td>2 человек</td>
        </tr>
        <tr>
          <td>5</td>
          <td>1 мин</td>
          <td>1 человек</td>
        </tr>
      </table>
    </section>

    <hr>

    <section>
      <h3>Как играть?</h3>
      <p>
        <img src="assets/images/info_card.svg" alt="">
        <b>Нет никаких ограничений на обмен информацией</b>, но карты можно раскрывать только двумя способами:
        <ol>
          <li><b>Частичное раскрытие</b> - в этом случае вы показываете только цвет карты, закрывая пальцем роль на карте.</li>
          <li><b>Полное раскрытие</b> - в этом случае вы показываете карту целиком, то есть и цвет, и роль.</li>
        </ol>
        <blockquote class="info"><i><img src="assets/images/info.svg" alt=""> Помните, что карты лучше показывать друг другу приватно, отойдя к краю комнаты</i></blockquote>
      <blockquote class="warning"><i><img src="assets/images/warning.svg" alt=""> <mark>Осторожно!</mark> При раскрытии карты, на вас могут быть <b>наложены эффекты</b> от роли человека, которому вы открылись. Далеко не всегда хорошие</i></blockquote>
      </p>
      <h4>При обмене информацией:</h4>
      <p class="blue">
        <img src="assets/images/shield_person.svg" alt="">
        <mark class="blue">Игрокам синей команды</mark> нужно защитить <mark class="blue">Президента</mark>, при этом не выдав важную информацию <mark class="red">Красной команде</mark>.
      <p>
      <p>
        <img src="assets/images/bomb.svg" alt="">
        <mark class="red">Игрокам красной команды</mark> нужно отправить <mark class="red">Бомбера</mark> к <mark class="blue">Президенту</mark>, при этом не выдав важную информацию <mark class="blue">Синей команде</mark>.
      </p>
    </section>

    <hr>

    <section>
      <h3>Роли</h3>
      <p>Существует около 20 ролей.</p>
      <p><i>Большинство ролей дают способности совершать некоторые действия при открытии карт.</i></p>
      <p>
        Накладываемые на вас эффекты от способностей другого человека могут:
        <ul>
          <li>Заставить вас отдать карту до конца игры</li>
          <li>Заставить вас обеменяться картами</li>
          <li>Дать вам условия и эффекты, длящиеся несколько раундов или даже всю игру</li>
          <li>Противоположные эффекты нивелируют друг друга</li>
        </ul>
      </p>
      <a href="search.html"><button><img src="assets/images/info_card.svg" alt="">К списку всех ролей →</button></a>
    </section>

    <hr>

    <section>
      <h2>На этом всё. Увидимся в игре!</h2>
    </section>
  </main>

  <div class="header-image"><img src="assets/images/people.svg" alt=""></div>
</section>


<script type="module" defer>
  import SW from './assets/scripts/SWTools.js';
  import {Teams, Pages} from './assets/scripts/pagesData.js';
  import {AllCachableResources} from './assets/scripts/constants.js';
  await SW.register();

  console.log('Ctrl + Alt + S to show data to generate QR\'s');
  window.addEventListener('keydown', (e) => {
    if (/([sы])/i.test(e.key) && e.ctrlKey && e.altKey) {
      e.preventDefault();
      console.log('Links and names to generating QR\'s:');
      console.log(Pages.roles.map((role, idx) => location.href.slice(0, location.href.lastIndexOf('/')) + `/role.html?idx=${idx}`).join(' '));
      console.log(Pages.roles.map(role => role.name).join('\n'));
      console.log(Pages.roles.map(role => role.name + '\n' + role.description).join('\n\n------------------\n\n'));
    }
  });

  const buttonDownload = document.getElementById('button-download');
  const downloadTextInfo = document.getElementById('button-download-text-info');
  const currentFileDownloadInfo = document.getElementById('button-download-current-info');
  const progressDownloadInfo = document.getElementById('button-download-progress-info');

  function showAllSiteSaved() {
    downloadTextInfo.innerHTML = `Сайт сохранен и доступен без интернета`;
    currentFileDownloadInfo.innerHTML = '<img src="assets/images/done.svg" alt="done">';
    progressDownloadInfo.innerHTML = '';
    buttonDownload.classList.add('done');
  }
  function showSavingError(errorUrl) {
    downloadTextInfo.innerHTML = `Ошибка при сохранении файлов сайта<br>${errorUrl}`;
    currentFileDownloadInfo.innerHTML = '<img src="assets/images/warning.svg" alt="error">';
    progressDownloadInfo.innerHTML = 'Сайт не будет доступен без интернета';
    buttonDownload.classList.add('error');
  }

  async function saveAllSite() {
    try {
      downloadTextInfo.innerHTML = `<img src="assets/images/download.svg" alt="download">Сохранение всего сайта на устройстве...`;
      buttonDownload.classList.remove('done');
      buttonDownload.classList.remove('error');
      await SW.cacheUrls(AllCachableResources, ({current, progress, total}) => {
        currentFileDownloadInfo.innerHTML = current;
        progressDownloadInfo.innerHTML = `${progress}/${total}`;
      });
      showAllSiteSaved();
    } catch (err) {
      console.log(err);
      showSavingError(err);
    }
  }
  async function saveAllIfNotSaved() {
    if (await SW.isFilesCached(AllCachableResources)) {
      showAllSiteSaved();
      return;
    }
    await saveAllSite();
  }

  buttonDownload.addEventListener('click', saveAllSite);
  saveAllIfNotSaved();
</script>
</body>
</html>
